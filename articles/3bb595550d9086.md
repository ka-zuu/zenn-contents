---
title: "è‡ªå®…ã‚µãƒ¼ãƒã«USB-HDDã¤ãªã’ã¦NASåŒ–ã—ãŸã®ã§ã€AWS S3ã¸è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’æ¤œè¨ã—ã¦å®Ÿè·µã—ã¦ã¿ãŸ"
emoji: "ğŸ’½"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Linux,è‡ªå®…ã‚µãƒ¼ãƒ,bash,aws,s3]
published: true
---

## æ¦‚è¦
ä¹…ã—ã¶ã‚Šã«è‡ªå®…ã‚µãƒ¼ãƒã®ç«‹ã¡ä¸Šã’ã‚’ã—ãŸã€‚
ã‚‚ã¨ã‚‚ã¨ã¯ãƒ©ã‚ºãƒ‘ã‚¤4ã§ãƒã‚¤ã‚¯ãƒ©ã‚µãƒ¼ãƒã‚’ç«‹ã¡ä¸Šã’ã¦ã„ãŸã‘ã©ã€ã‚¹ãƒšãƒƒã‚¯ä¸è¶³ã ã£ãŸã“ã¨ã¨ã€dockerã‚’ä½¿ã„ãŸã‹ã£ãŸã®ã§Armã˜ã‚ƒãªãã¦Intelã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã‚µãƒ¼ãƒãŒæ¬²ã—ã‹ã£ãŸã®ã§ã€ç«‹ã¡ä¸Šã’ã«è‡³ã‚‹ã€‚
ã›ã£ã‹ããªã®ã§ã€HDDã‚’USBã§æ¥ç¶šã—ã¦NASåŒ–ã€‚

NASåŒ–ã—ãŸã‹ã‚‰ã«ã¯ã€ãã“ã«ä¿å­˜ã—ãŸãƒ‡ãƒ¼ã‚¿ã¯çµ¶å¯¾ã«ãªãã•ãªã„ã‚ˆã†ãªé‹ç”¨ã‚’ã—ãŸã„ã€‚
ã¨ã„ã†ã‚ã‘ã§ã€å®šæœŸçš„ã«AWS S3ã¸ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹ã“ã¨ã«ã—ãŸã€‚
S3ã¸ã¯å·®åˆ†ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã§ã€å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã ã‘æ›´æ–°ã™ã‚‹ã€‚
ã¾ãŸã€ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚’æœ‰åŠ¹ã«ã—ã¦ã€ä¸€å®šæœŸé–“ã¯å‰Šé™¤ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã€‚
ãã—ã¦ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¾Œä¸€å®šæœŸé–“ãŒçµŒã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚³ã‚¹ãƒˆã®å®‰ã„ä¿ç®¡è¨­å®šã«ç§»è¡Œã™ã‚‹ã€‚


## ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ãƒ«ãƒ¼ãƒ«ã‚’è€ƒãˆã‚‹
1. USBãƒãƒ¼ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ãã®ã¾ã¾S3ã¸ä¿å­˜ã™ã‚‹
    - åœ§ç¸®ç­‰ã¯ã—ãªã„ã€‚ä»Šå›ä¿å­˜ã—ãŸã„ã®ã¯ã€å†™çœŸã‚„éŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã§ã€åœ§ç¸®ã®åŠ¹æœãŒè–„ã„
    - ï¼ˆåœ§ç¸®ãŒå¿…è¦ã«ãªã£ãŸã‚‰è€ƒãˆã‚‹ãƒ»ãƒ»ãƒ»ï¼‰
    - ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå˜ä½ã§æ›´æ–°åˆ¤æ–­ã•ã‚Œã‚‹ã®ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€ã¤ã«ã¾ã¨ã‚ãŸã‚Šã‚‚ã—ãªã„
1. s3ã§ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚’æœ‰åŠ¹ã«ã™ã‚‹
    - éå»ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã€åŠå¹´ä¿å­˜å¾Œå‰Šé™¤ã™ã‚‹
    - ãã‚‚ãã‚‚NASã«ç½®ããƒ•ã‚¡ã‚¤ãƒ«ã¯åº¦ã€…æ›´æ–°ã™ã‚‹ã‚‚ã®ã§ã¯ãªã„ã®ã§ã€ãã‚Œã»ã©åµ©å¼µã‚‰ãªã„æƒ³å®š
1. aws cliã§ã€s3ã¸å·®åˆ†ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ã™ã‚‹
    - ãƒ­ãƒ¼ã‚«ãƒ«ã«å­˜åœ¨ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’s3ã¸syncã§ä¸€æ°—ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
    - ãƒ­ãƒ¼ã‚«ãƒ«ã§å‰Šé™¤ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€s3ã§ã‚‚å‰Šé™¤ã™ã‚‹
        - ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚’æœ‰åŠ¹ã«ã—ã¦ã„ã‚‹ã®ã§ã€å‰Šé™¤ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚‚æ•°ãƒ¶æœˆã¯æ•‘å‡ºå¯èƒ½
1. æœã€æ¯æ—¥ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹
    - ã¾ãšã€ã‚µãƒ¼ãƒå†…ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’ã€USB-HDDã«ä¿ç®¡ã™ã‚‹
    - USB-HDDã®å†…å®¹ã¯ã€å…¨ã¦ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¯¾è±¡ã¨ã™ã‚‹
    - æ˜ã‘æ–¹ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å‡¦ç†ã‚’å®Ÿè¡Œ
    - ãƒ­ã‚°ã®å–å¾—ã¨ã€å®Ÿè¡Œçµæœã®é€šçŸ¥ã‚’ã™ã‚‹ï¼ˆä»Šå›ã¯æœªå®Ÿè£…ï¼‰

## ä½™è«‡ï¼‰S3ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹ã«ã¤ã„ã¦
S3ã«ä¿å­˜ã™ã‚‹ã«ã‚ãŸã£ã¦ã€S3ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹ã«ã¤ã„ã¦èª¿ã¹ãŸã‚‰ã€**S3 Glacier Instant Retrieval**ã¨**Intelligent-Tiering**ã¨ã„ã†ã‚¯ãƒ©ã‚¹ãŒå®Ÿè£…ã•ã‚ŒãŸã“ã¨ã‚’çŸ¥ã£ãŸã€‚
ã“ã¡ã‚‰ã®è¨˜äº‹ã§ãã‚Œãã‚Œã®ç‰¹å¾´ãŒã‚ã‹ã‚‹ã€‚
[ã€AWSã€‘S3ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹ã«ã¤ã„ã¦ã¾ã¨ã‚ã‚‹](https://qiita.com/masato930/items/cb9ba948c696211b3ee5)
ã“ã¡ã‚‰ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹ã‚’é¸æŠã™ã‚‹ã¨ãã«å¿…è¦ãªæƒ…å ±ãŒè©³ã—ã„ã€‚
[S3ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹ã®é¸æŠã«è¿·ã£ãŸæ™‚ã«è¦‹ã‚‹ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ä½œã£ã¦ã¿ãŸ(2022å¹´8æœˆç‰ˆ)](https://dev.classmethod.jp/articles/s3-storage-class-choice-flowchart-2022-8/)

ä»Šå›ä¿ç®¡ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãªã®ã§ã€ã¾ã•ã«Glacier Instant Retrievalå‘ãï¼
S3æ¨™æº–ã¯0.025USD/GBã€1ã‚¾ãƒ¼ãƒ³ IAã§0.011USD/GBã®ã¨ã“ã‚ã€Instant Retrievalã¯é©šç•°ã®**0.005USD/GB**ã€‚
æ—§Glacierã“ã¨Glacier Flexible Retrievalã®0.0045USD/GBã¨10%ã—ã‹å¤‰ã‚ã‚‰ãªã„ã€‚ç´ æ™´ã‚‰ã—ã„ã€‚
ã—ã‹ã‚‚å–ã‚Šå‡ºã—ã¯ãƒŸãƒªç§’å˜ä½ã§ã§ãã‚‹ã¨ã„ã†ã“ã¨ã§ã€æ—§Glacierã‚’é¸æŠã™ã‚‹ç†ç”±ãŒãªããªã£ãŸå°è±¡ã€‚ï¼ˆAWSçš„ã«ã¯ã€æ—§Glacierã¯é‹ç”¨è€ƒãˆã‚‹ã¨å¾®å¦™ã«ãªã£ã¦ããŸã®ã‹ãªï¼‰
ç‰¹å¾´ã¯ä¸Šè¨˜è¨˜äº‹ã«è©³ã—ã„ãŒã€å–ã‚Šå‡ºã—ã®ãŸã‚ã®ã‚³ã‚¹ãƒˆãŒGBã‚ãŸã‚Š0.03USDã‹ã‹ã‚‹ã®ãŒãƒã‚¤ãƒ³ãƒˆã€‚ä»Šå›ã¯ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãªã®ã§å•é¡Œã«ãªã‚‰ãªã„ã€‚
* ã¡ãªã¿ã«ã€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«è¨­å®šã§æ¨™æº–ã‹ã‚‰ä½é »åº¦ã‚¢ã‚¯ã‚»ã‚¹ã¸ã®ç§»è¡Œã¯30æ—¥ä»¥ä¸ŠçµŒã£ã¦ã„ãªã„ã¨ã§ããªã„ã‘ã©ã€Instant Retrievalã«ã¯1æ—¥ã§ã‚‚ç§»è¡Œå¯èƒ½ã€‚

ã¾ãŸã€ä¿ç®¡ã—ã¦ã—ã°ã‚‰ãçµŒã£ãŸã‚‰ã€ã‚¢ã‚¯ã‚»ã‚¹ã®å¯èƒ½æ€§ã¯ä½ããªã‚‹ã¨æƒ³å®šã€‚ã¤ã¾ã‚Šã€HDDãŒå£Šã‚Œã‚‹1å›ã ã‘ã«ãªã‚‹ã¯ãšã€‚S3 Glacier Deep Archiveã«ç§»è¡Œã™ã‚‹ã€‚
æœ€å°ä¿å­˜æœŸé–“ãŒ180æ—¥ã«ãªã‚‹ã®ã§ã€åŠå¹´ã«ä¸€å›ã®æ›´æ–°ã‚‚ãªã„ã“ã¨ã‚’æƒ³å®šã€‚

Intelligent-Tieringã‚‚ã„ã„ã‹ã‚‚ã¨æ€ã£ãŸã€‚è‡ªå‹•ã§æ¨™æº–â†’ä½é »åº¦ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆIAï¼‰â†’Glacier Instant Retrievalã¸ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹ã‚’å¤‰æ›´ã—ã¦ãã‚Œã‚‹ã€‚
[S3 Intelligent-Tiering ã®ã—ãã¿](https://docs.aws.amazon.com/ja_jp/AmazonS3/latest/userguide/intelligent-tiering-overview.html)
ãŸã ã€Objectã®ã‚µã‚¤ã‚ºãŒ128KBã‚ˆã‚Šå¤§ããªã‚‚ã®ã«å¯¾ã—ã¦ã¯ã‚¢ã‚¯ã‚»ã‚¹ã®æœ‰ç„¡ã‚’åˆ¤å®šã™ã‚‹ãŸã‚ã«ã€ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚³ã‚¹ãƒˆã¨ã„ã†ã‚‚ã®ãŒã‹ã‹ã‚‹($0.0025 per 1000 OBJ)
ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹ã‚’å®‰ã„æ–¹ã¸ç§»å‹•ã™ã‚‹ã“ã¨ã—ã‹ãªã„ã¯ãšãªã®ã§ã€Intelligent-Tieringã¯ã‚³ã‚¹ãƒˆé¢ã§ä¸é©ã‹ãªãƒ¼ã¨ã„ã†ã“ã¨ã§è¦‹é€ã‚Šã€‚

       
## ã‚„ã‚‹ã“ã¨

1. ä¿å­˜å…ˆã®S3ãƒã‚±ãƒƒãƒˆã®ä½œæˆ
1. S3ãƒã‚±ãƒƒãƒˆã¸ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®è¨­å®š
1. S3ä¿å­˜ã ã‘ã§ãã‚‹IAMãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã€ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ãƒ»ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã‚’ç”¨æ„
1. ã‚µãƒ¼ãƒã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ãƒãƒƒãƒã‚’ä½œæˆ

### ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆ

ä»Šå›ã¯ä½œæˆæ¸ˆã¿ã ã£ãŸã®ã§å‰²æ„›ã€‚

### ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®è¨­å®š

![](/images/3bb595550d9086/backet_rule.jpg)


### IAMã‚’ä½œæˆã€ã‚­ãƒ¼ã‚’å–å¾—

é‹ç”¨ã‚’è€ƒæ…®ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã‚°ãƒ«ãƒ¼ãƒ—ã«æ‰€å±ã•ã›ã€ã‚°ãƒ«ãƒ¼ãƒ—ã«ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã™ã‚‹ã€‚

* å¯¾è±¡ã®ãƒã‚±ãƒƒãƒˆã‚’æ“ä½œã§ãã‚‹æ¨©é™ã‚’æŒã£ãŸãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆ
* ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒã‹ã‚‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ã™ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ
    - ã“ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«æ‰€å±ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®ã‚µãƒ¼ãƒå†…ã‹ã‚‰S3ã¸ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹äººãŸã¡ã¨ã„ã†ã“ã¨ãŒã‚ã‹ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
    - åå‰ã®ä¾‹ï¼šbackup_to_s3_from_local_server
* ä»Šå›ã®ã‚µãƒ¼ãƒã‹ã‚‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ã™ã‚‹ãŸã‚ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
    - ã©ã®ã‚µãƒ¼ãƒã‹ã‚‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹äººãªã®ã‹ãŒåˆ†ã‹ã‚‹åå‰ã«ã™ã‚‹ã€‚
    - åå‰ã®ä¾‹ï¼šbackup_to_s3_from_local_server_raspi


### ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒã®è¨­å®š

AWS CLIã®æº–å‚™ã¯ã“ã¡ã‚‰ãŒå‚è€ƒã«ãªã‚‹ã€‚
[AWS CLI ã®ã¿ã§ S3 ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ–¹æ³•](https://www.aska-ltd.jp/jp/blog/237)
* ä»Šå›ã¯ã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ã¤ã‘ã¾ã—ãŸï¼šs3backup

AWS CLIã§S3ã‚’æ“ä½œã™ã‚‹æ–¹æ³•ã¯ã€ã“ã¡ã‚‰ãŒã‚ã‹ã‚Šã‚„ã™ã„ã€‚
[AWS CLIã§S3æ“ä½œ(ls,mb,rb,cp,mv,rm,sync)](https://www.wakuwakubank.com/posts/642-aws-cli-s3/#index_id12)


### ãƒãƒƒãƒã‚’ä½œæˆ
ã‚„ã‚‹ã“ã¨ã¯ä»¥ä¸‹ã€‚
1. ç‰¹å®šã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’tarã—ã¦ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¯¾è±¡ã®USBHDDãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜ã™ã‚‹ãƒãƒƒãƒ
2. USBHDDãƒ•ã‚©ãƒ«ãƒ€ã‚’ã¾ã‚‹ã”ã¨s3ã¸ä¿å­˜ã™ã‚‹ãƒãƒƒãƒ

#### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’çºã‚ã‚‹å‡¦ç†
ãƒã‚¤ã‚¯ãƒ©ã‚µãƒ¼ãƒã®ãƒ‡ãƒ¼ã‚¿ã‚’ã¾ã¨ã‚ã‚‹ä¾‹ã€‚
ãƒãƒƒãƒã®å®Ÿè¡Œãƒ­ã‚°ã¯ã€ãƒãƒƒãƒã®ç½®ã„ã¦ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«logãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¦ä¿å­˜ã™ã‚‹

```bash
#!/bin/bash -xvue

# ãƒãƒƒãƒã®ãƒ­ã‚°ä¿å­˜å‡¦ç†
cur_dir="$(dirname $0)"
filename="$(basename $0)"
mkdir -p ${cur_dir}/log
exec 2> ${cur_dir}/log/${filename}.$(date +%Y%m%d_%H%M%S)

# ãƒã‚¤ã‚¯ãƒ©ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹ã€‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æº–å‚™
backup_dir="/mnt/usbhdd/backup/minecraft/auto_backup"
mkdir -p ${backup_dir}

target_dir="${HOME}/minecraft"
cd ${target_dir}

# å¯¾è±¡ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’1ã¤ãšã¤å›ºã‚ã¦ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¯¾è±¡ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ä¿ç®¡
while read filename; do
        tar zcf ${backup_dir}/${filename}.tgz ${filename}
done < <(ls -1)

exit 0
```

#### USB-HDDã‚’S3ã¸ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹ãƒãƒƒãƒ
ã“ã¡ã‚‰ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ã€å¯¾è±¡ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’syncã§ä¸€æ°—ã«ã‚³ãƒ”ãƒ¼ã€‚
è‡ªå‹•çš„ã«ã€å·®åˆ†ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã‚’ã€ãƒãƒ«ãƒãƒ‘ãƒ¼ãƒˆã§é«˜é€Ÿã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã‚Œã‚‹ã€‚
æ‰‹å…ƒã®ã‚µãƒ¼ãƒã‹ã‚‰ã ã¨ã€50MB/sãã‚‰ã„å‡ºã¦ã„ã¾ã—ãŸã€‚
```bash
#!/bin/bash -xveu

# ãƒãƒƒãƒã®ãƒ­ã‚°ä¿å­˜å‡¦ç†
cur_dir="$(dirname $0)"
filename="$(basename $0)"
mkdir -p ${cur_dir}/log
exec 2> ${cur_dir}/log/${filename}.$(date +%Y%m%d_%H%M%S)

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å‡¦ç†
backup_dir="/mnt/usbhdd"
target_s3dir="s3://backetname/backup/usbhdd"

aws --profile=s3backup s3 sync ${backup_dir} ${target_s3dir} --delete --storage-class GLACIER_IR

exit 0
```

syncã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦ã¯ã€`--delete`ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§å‰Šé™¤ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚µãƒ¼ãƒå´ã§ã‚‚å‰Šé™¤ã™ã‚‹ã‚ˆã†ã«æŒ‡å®šã€‚
ãŸã ã—ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚’æœ‰åŠ¹ã«ã—ã¦ã„ã‚‹ã®ã§ã€å‰Šé™¤å¾ŒåŠå¹´ã¯å¾©æ´»å¯èƒ½ã€‚
ã¾ãŸã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ç‚¹ã§Glacier Instant Retrievalã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã®`--storage-class GLACIER_IR`ã€‚ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã§ã‚‚3æ—¥å¾Œã«ç§»è¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ãŒã€æœ€åˆã‹ã‚‰ã“ã‚Œã«ã—ã¦ãŠãã€‚
[Amazon S3 Glacier ã¯ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã™ã‚‹ã®ã«æœ€é© â€“ S3 Glacier Instant Retrieval ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹ã®ã”ç´¹ä»‹](https://aws.amazon.com/jp/blogs/news/amazon-s3-glacier-is-the-best-place-to-archive-your-data-introducing-the-s3-glacier-instant-retrieval-storage-class/)

### cronã¸ç™»éŒ²
`crontab -e`ã—ã¦ã€ä¸Šè¨˜ãƒãƒƒãƒã‚’ç™»éŒ²ã™ã‚‹ã€‚
å®Ÿè¡Œã—ã¦ã¿ã¦ã€logãƒ•ã‚©ãƒ«ãƒ€ã®ãƒ­ã‚°ã‚’ç¢ºèªã™ã‚‹ã€‚

## ã¾ã¨ã‚
ä¹…ã—ã¶ã‚Šã«ã‚µãƒ¼ãƒã‚’å»ºã¦ã‚‹ã®ã‚‚æ¥½ã—ã‹ã£ãŸã‘ã©ã€S3ã¨bashã‚‚è§¦ã‚Œã¦è‰¯ã‹ã£ãŸã€‚
é‹ç”¨é¢ã§å‡¦ç†é€šçŸ¥ã¨ã‹ã¾ã ã§ãã¦ã„ãªã„ã®ã§ã€ãã‚Œã‚’å®Ÿè£…ã™ã‚‹ã®ãŒæ¬¡ã®ãƒ†ãƒ¼ãƒã‹ãªãƒ¼

